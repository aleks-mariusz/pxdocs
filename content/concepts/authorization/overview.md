---
title: Security Overview
description: Security concepts and features available within Portworx
keywords: security, ownership, RBAC, Role Based Access Control, claims, JWT, JSON Web Token, OIDC, OpenID Connect, self generated, overview, how to, administrator role, explanation
weight: 10
series: authorization
---
## Introduction

As of version 2.1, Portworx features enhanced authN/authZ security called PX-Security. This
section provides a high-level overview of the concepts behind securing a Portworx
cluster.

In addition to PX-Security, in order to enhance security further, consideration should
also be made of securing other key Portworx components, such as the KVDB (usually etcd),
and is discussed [in this section](/reference/knowledge-base/etcd/#securing-with-certificates-in-kubernetes).

## Overview

Our PX-Security feature centers around the ubiquitous JWT-based authentication and
authorization mechanisms. These security techniques are leveraged by many IT systems
and are a proven model for user/account identification and permissioning.

Within a Portworx Cluster with PX-Security enabled, a storage-client entity (user)
first authenticates with a token authority (TA), which generates a token for the
user, signed using either a private key or a shared secret. The user then provides
this token to Portworx for identification. **No passwords are ever transmitted to
Portworx**.

This approach allows Portworx to only have to verify the validity of a token issued
to a user for Portworx to be able to authenticate the user (as it is configured to
trust the private key/shared key only the TA would also have). Portworx discards
tokens after validation thus **tokens are never saved on a Portworx system**.

The token also contains a _claims_ section which not only positively identifies who
the user is, but also provides authorization information in role-based-access-control
(RBAC) form. Portworx uses that RBAC information to determine if the user is
permitted to make their storage-related request.

## Terminology

| Term | Definition |
| ---- | ---------- |
| ACL | Access Control List identifying those accounts which can access a resource|
| claims | Information contained in the payload of the JWT identifying the owner of the request |
| CO | Container Orchestrator like Kubernetes, Mesosphere, Nomad, etc. |
| JWT | JSON Web Token |
| OIDC | OpenID Connect |
| RBAC | Role Based Access Control defined by the rules of a role |
| role | A named set of rules |
| rule | A description of permissions for a role |
| token | A JSON Web Token which is signed by a token authority identifying the owner of the request |
| token authority | Application used to generate and sign an identification token |

## PX-Security Concepts

Portworx security is composed of three well-defined concepts:

1. **Authentication** - verifying a user is identified correctly, based on
the token provided by the user.
2. **Authorization** - verifying permissions to perform a particular
request according to the role or roles applied to the user.
3. **Ownership**- determining access to resources.

### Authentication

Portworx determines the validity of a user through a token-based approach. Upon
authentation to a TA, a token is generated by the TA for the user and will contain
identification information about the user in the _claims_ section.

When Portworx receives a request accompanying this token from the user, it will
check the token validity by verifying its signature, using either a shared secret or
public key provided during configuration.

### Authorization

Once the token has been determined to be valid, Portworx is then able to check if
the user is authorized to make the request using the _roles_ claim in the token,
which must contain the name of an existing role, either a default (built-in) role or
custom role registered in the Portworx system.

A role is the name given to a set of RBAC rules which enable access to certain SDK
calls. Custom roles can be created using `pxctl` or through the [OpenStorage SDK](https://libopenstorage.github.io/w/release-6.1.generated-api.html#serviceopenstorageapiopenstoragerole).

See also [Role management using pxctl](/reference/cli/role)

### Ownership

Ownership is used for resource control. This model is composed of the owner and a
list of groups and collaborators with access to the resource. Groups and
collaborators can also have their access to a resource constrained by their access
type.

The following table defines the three access types supported:

| Type | Description |
| ---- | ----------- |
| Read | Has access to view or copy the resource. Cannot affect or mutate the resource. |
| Write | Has _Read_ access plus permission to modify the resource. |
| Admin | Has _Write_ access plus the ability to delete the resource. |

For example, `user1` could create a volume and give _Read_ access to `group1`. This
means that only `user1` can mount the volume. However, `group1` can clone the volume.
When a volume is cloned, it is owned by the user who made the request.

## Tokens

A token is a signed set of user-attributes and identification parameters generated by
the Token Authority.  It is provided to a user after successful authentication to the
TA, and the user passes this to Portworx for validation along with their request.

### Validation

For Portworx to verify tokens are valid, they must be signed with either:

* a shared secret
* a RSA private key or
* an ECDSA private key

Portworx must also be configured with the same shared secret or pair of keys since
this is how Portworx knows to trust the TA.

Once Portworx is able to determine the token to be validated was signed by the TA it
is configured to trust, Portworx, by extension, is also able to trust the contents of
the token (due to the user of cryptographic signatures that are part of the token),
and it then accepts the identity of the user providing the token.

### Sources

Portworx supports two sources for token generation: via the industry-standard
_OpenID Connect_ and using _self-generated_ tokens.

OpenID Connect (OIDC) is a stand-alone extension of the OAuth2 standard for user
authentication/management and is the preferred solution for enterprise customers as
it allows user-federation into corporate user management/identity provider systems
like Active Directory, LDAP directories, etc.

The other option is simply using self-generated tokens, where the administrator would
manually generate a token for each user using their own TA application. For
convenience, Portworx provides a method of generating tokens using `pxctl`.

While both can be used, choosing one over the other of these options is a trade-off
between scaleability and simplicity.  Whereas integrating with OpenID connect can be
initially complex, it is the superior solution once in place and is enterprise grade,
while using only the simpler self-signed token approach requires manual
management of users/tokens and does not scale very well beyond a handful of
identities.

#### OpenID Connect (OIDC)

With its ability to manage anywhere from tens to thousands of users, Portworx, Inc. strongly
recommends that enterprise customers enable PX-Security with an OpenID
Connect service. There are multiple public and private OIDC providers. Customers
can use public providers such as:
* [Okta.com](https://developer.okta.com/docs/reference/api/oidc/)
* [Auth0.com](https://auth0.com/docs/protocols/oidc)

Customers can also use private provider software such as:
* [Keycloak](https://www.keycloak.org/docs/latest/securing_apps/index.html#openid-connect-2)
* [Dex](https://github.com/dexidp/dex#dex---a-federated-openid-connect-provider)
* [CloudFoundry UAA](https://github.com/cloudfoundry/uaa#cloudfoundry-user-account-and-authentication-uaa-server)
* [Tremolo Security OpenUnison](https://www.tremolosecurity.com/docs/tremolosecurity-docs/1.0.15/openunison/openunison-manual.html)

In the case where the claim attributes required by PX-Security do not match
with those provided by the customer, most OIDCs have the ability to map certain
attributes from one system to another. This functionality allows the OIDC-based TA to
return a token to the Portworx storage-client entity where the claims have the
appropriate information.

Some OIDC systems may also namespace custom claims. This is supported by Portworx,
but the namespace value must be pre-configured and provided to Portworx during
initialization.

#### Self-Generated Tokens

Token generation can be done by any JWT-compliant application which sets the claims
required by Portworx. For convenience, administrators can generate user tokens using
`pxctl`. See [Generating Tokens](/reference/cli/authorization/#generate_tokens).

### Claims

Portworx also requires a set of "claims" to be included in the JWT in order to
properly authorize the user.

The following table lists the set of required claims:

| Claim | Type | Description |
| ----- | ---- | ----------- |
| iss | string | Name of the issuer. Portworx utilizes this information to determine if the token was issued by a trusted token authority |
| sub | string | Subject (unique ID for the user). It is used to identify the user to determine access control of resources |
| exp | date | Expiration date |
| iat | date | Issued at time |
| name | string | Name of the user |
| email | string | Email of the user. Portworx may be configured to use the email as the unique identifier of the user |
| roles | string array | (custom claim) Portworx RBAC roles |
| groups | string array | (custom claim) List of groups the user is part of, used determine access control of resources |

## Administrator Role

Similar to the `root` superuser in a Linux system, Portworx has the concept of a
system-administrator role. This role is unrestricted (in RBAC) and is a member of
_every_ group.

The built-in RBAC role for system administrators is called `system.admin` and gives
the caller access to all API calls.

To have access to every resource, a user must be in group `*`, which means they are
part of every group. Their token claims would then look like this:

```json
{
  "roles" : [ "system.admin" ],
  "groups": [ "*" ]
}
```

## References
For more inforamtion, see also:

* [OpenID Connect](https://openid.net)
* [JWT.io](https://jwt.io)
* [OpenStorge SDK](https://libopenstorage.github.io/w/)
* [Authorization with pxctl](/reference/cli/authorization)
* [Role management with pxctl](/reference/cli/role)
